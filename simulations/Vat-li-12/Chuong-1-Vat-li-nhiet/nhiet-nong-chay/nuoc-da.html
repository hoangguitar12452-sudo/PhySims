<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>DePhys - Mô Phỏng Nghiệm Nhiệt Nóng Chảy</title>

    <!-- Thư viện React & ReactDOM -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>

    <!-- Babel để biên dịch JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Roboto", sans-serif;
        -webkit-tap-highlight-color: transparent;
      }
      .font-mono {
        font-family: "JetBrains Mono", monospace;
      }

      /* Custom Animations */
      @keyframes pulse-slow {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.8;
        }
      }
      .animate-pulse-slow {
        animation: pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }

      @keyframes bounce-slow {
        0%,
        100% {
          transform: translateY(-5%);
        }
        50% {
          transform: translateY(0);
        }
      }
      .animate-bounce-slow {
        animation: bounce-slow 2s infinite;
      }

      /* Hide Scrollbar but keep functionality */
      .scrollbar-hide::-webkit-scrollbar {
        display: none;
      }
      .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-800 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // --- ICON COMPONENTS (SVG) ---
      const Icons = {
        Play: (props) => (
          <svg
            {...props}
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <polygon points="5 3 19 12 5 21 5 3" />
          </svg>
        ),
        Pause: (props) => (
          <svg
            {...props}
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <rect x="6" y="4" width="4" height="16" />
            <rect x="14" y="4" width="4" height="16" />
          </svg>
        ),
        RotateCcw: (props) => (
          <svg
            {...props}
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
            <path d="M3 3v5h5" />
          </svg>
        ),
        Flame: (props) => (
          <svg
            {...props}
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.1.2-2.2.5-3.3a9 9 0 0 0 3 3.3Z" />
          </svg>
        ),
        Thermometer: (props) => (
          <svg
            {...props}
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z" />
          </svg>
        ),
        Clock: (props) => (
          <svg
            {...props}
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <circle cx="12" cy="12" r="10" />
            <polyline points="12 6 12 12 16 14" />
          </svg>
        ),
        Info: (props) => (
          <svg
            {...props}
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <circle cx="12" cy="12" r="10" />
            <path d="M12 16v-4" />
            <path d="M12 8h.01" />
          </svg>
        ),
        FlaskConical: (props) => (
          <svg
            {...props}
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <path d="M10 2v7.527a2 2 0 0 1-.211.896L4.72 20.55a1 1 0 0 0 .9 1.45h12.76a1 1 0 0 0 .9-1.45l-5.069-10.127A2 2 0 0 1 14 9.527V2" />
            <path d="M8.5 2h7" />
            <path d="M7 16h10" />
          </svg>
        ),
        Calculator: (props) => (
          <svg
            {...props}
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <rect width="16" height="20" x="4" y="2" rx="2" />
            <line x1="8" x2="16" y1="6" y2="6" />
            <line x1="16" x2="16" y1="14" y2="18" />
            <path d="M16 10h.01" />
            <path d="M12 10h.01" />
            <path d="M8 10h.01" />
            <path d="M12 14h.01" />
            <path d="M8 14h.01" />
            <path d="M12 18h.01" />
            <path d="M8 18h.01" />
          </svg>
        ),
        ArrowLeft: (props) => (
          <svg
            {...props}
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            strokeWidth="2"
            strokeLinecap="round"
            strokeLinejoin="round"
          >
            <path d="m12 19-7-7 7-7" />
            <path d="M19 12H5" />
          </svg>
        ),
      };

      const IceMeltingSim = () => {
        // --- Constants ---
        const INITIAL_TEMP = -10;
        const MELTING_POINT = 0;
        const TARGET_TEMP = 20;

        const LAMBDA_ICE_REAL = 334000;
        const C_ICE = 2100;
        const C_WATER = 4180;

        // --- State Inputs ---
        const [mass, setMass] = useState(0.1);
        const [power, setPower] = useState(100);

        // --- Simulation State ---
        const [isRunning, setIsRunning] = useState(false);
        const [simTime, setSimTime] = useState(0);
        const [temp, setTemp] = useState(INITIAL_TEMP);
        const [phase, setPhase] = useState("SOLID");
        const [meltingProgress, setMeltingProgress] = useState(0);

        const [graphData, setGraphData] = useState([
          { timeMin: 0, temp: INITIAL_TEMP, phase: "SOLID" },
        ]);
        const [hoverInfo, setHoverInfo] = useState(null);
        const graphRef = useRef(null);

        // --- Experiment Results State ---
        const [experimentResults, setExperimentResults] = useState([]);
        const [currentRunId, setCurrentRunId] = useState(1);
        const [meltingStartTime, setMeltingStartTime] = useState(null);
        const [meltingEndTime, setMeltingEndTime] = useState(null);
        const [errorFactor, setErrorFactor] = useState(1);

        // --- Simulation Logic ---
        useEffect(() => {
          let interval = null;
          if (isRunning) {
            interval = setInterval(() => {
              updateSimulation();
            }, 100);
          }
          return () => clearInterval(interval);
        }, [isRunning, simTime, phase, temp, mass, power, errorFactor]);

        useEffect(() => {
          if (simTime === 0 && !isRunning) {
            setErrorFactor(0.95 + Math.random() * 0.1);
          }
        }, [simTime, isRunning]);

        const updateSimulation = () => {
          const dt = 6;
          const newTime = simTime + dt;
          setSimTime(newTime);
          const energyInput = power * dt * errorFactor;
          let newTemp = temp;
          let newPhase = phase;
          let newProgress = meltingProgress;

          if (phase === "SOLID") {
            const deltaT = energyInput / (mass * C_ICE);
            if (temp + deltaT >= MELTING_POINT) {
              newTemp = MELTING_POINT;
              newPhase = "MELTING";
              setMeltingStartTime(newTime);
            } else {
              newTemp = temp + deltaT;
            }
          } else if (phase === "MELTING") {
            const totalEnergyNeeded = mass * LAMBDA_ICE_REAL;
            const progressStep = (energyInput / totalEnergyNeeded) * 100;
            if (meltingProgress + progressStep >= 100) {
              newProgress = 100;
              newPhase = "LIQUID";
              setMeltingEndTime(newTime);
              saveResult(newTime);
            } else {
              newProgress = meltingProgress + progressStep;
            }
            newTemp = MELTING_POINT;
          } else if (phase === "LIQUID") {
            const deltaT = energyInput / (mass * C_WATER);
            newTemp = temp + deltaT;
            if (newTemp >= TARGET_TEMP) {
              setIsRunning(false);
            }
          }

          setTemp(newTemp);
          setPhase(newPhase);
          setMeltingProgress(newProgress);

          setGraphData((prev) => {
            const lastPoint = prev[prev.length - 1];
            const currentTimeMin = newTime / 60;
            if (
              currentTimeMin - lastPoint.timeMin >= 0.1 ||
              newPhase !== lastPoint.phase
            ) {
              return [
                ...prev,
                { timeMin: currentTimeMin, temp: newTemp, phase: newPhase },
              ];
            }
            const newData = [...prev];
            newData[newData.length - 1] = {
              timeMin: currentTimeMin,
              temp: newTemp,
              phase: newPhase,
            };
            return newData;
          });
        };

        const saveResult = (endTime) => {
          if (meltingStartTime === null) return;
          const durationSeconds = endTime - meltingStartTime;
          const calculatedLambda = (power * durationSeconds) / mass;
          const newResult = {
            id: currentRunId,
            mass: mass,
            power: power,
            timeDuration: durationSeconds,
            lambda: calculatedLambda,
          };
          setExperimentResults((prev) => [...prev, newResult]);
          setCurrentRunId((prev) => prev + 1);
        };

        const handleReset = () => {
          setIsRunning(false);
          setSimTime(0);
          setTemp(INITIAL_TEMP);
          setMeltingProgress(0);
          setPhase("SOLID");
          setGraphData([{ timeMin: 0, temp: INITIAL_TEMP, phase: "SOLID" }]);
          setMeltingStartTime(null);
          setMeltingEndTime(null);
          setHoverInfo(null);
        };

        const handleClearData = () => {
          setExperimentResults([]);
          setCurrentRunId(1);
        };

        // Helpers
        const getAverageLambda = () => {
          if (experimentResults.length === 0) return 0;
          const sum = experimentResults.reduce(
            (acc, curr) => acc + curr.lambda,
            0
          );
          return sum / experimentResults.length;
        };
        const getThermometerHeight = (currentTemp) =>
          Math.min(Math.max(((currentTemp - -15) / (30 - -15)) * 100, 0), 100);
        const formatNumber = (num) =>
          new Intl.NumberFormat("vi-VN", { maximumFractionDigits: 0 }).format(
            num
          );
        const formatTimeDigital = (seconds) => {
          const mins = Math.floor(seconds / 60);
          const secs = Math.floor(seconds % 60);
          return `${mins}:${secs < 10 ? "0" : ""}${secs}`;
        };

        // Graph Logic
        const GRAPH_MIN_Y = -15;
        const GRAPH_MAX_Y = 25;
        const GRAPH_Y_RANGE = GRAPH_MAX_Y - GRAPH_MIN_Y;
        const maxTimeAxis = Math.max(20, Math.ceil(simTime / 60 / 5) * 5 + 5);
        const getXPos = (timeMin) => (timeMin / maxTimeAxis) * 100;
        const getYPos = (tempVal) =>
          100 - ((tempVal - GRAPH_MIN_Y) / GRAPH_Y_RANGE) * 100;

        const handleGraphMouseMove = (e) => {
          if (!graphRef.current || graphData.length === 0) return;
          const rect = graphRef.current.getBoundingClientRect();
          const mouseX = e.clientX - rect.left;
          const timeAtMouse = (mouseX / rect.width) * maxTimeAxis;
          let closest = graphData[0];
          let minDiff = Math.abs(closest.timeMin - timeAtMouse);
          for (let i = 1; i < graphData.length; i++) {
            const diff = Math.abs(graphData[i].timeMin - timeAtMouse);
            if (diff < minDiff) {
              minDiff = diff;
              closest = graphData[i];
            }
          }
          setHoverInfo({
            x: getXPos(closest.timeMin),
            y: getYPos(closest.temp),
            time: closest.timeMin,
            temp: closest.temp,
            phase: closest.phase,
          });
        };

        const handleGraphMouseLeave = () => {
          setHoverInfo(null);
        };

        return (
          <div className="flex flex-col items-center min-h-screen bg-slate-50 p-3 sm:p-6 font-sans text-slate-800 relative overflow-x-hidden">
            <header className="mb-6 text-center w-full max-w-4xl mx-auto">
              <h1 className="text-xl sm:text-3xl font-bold text-blue-900 mb-2 leading-tight">
                Thí Nghiệm Đo Nhiệt Nóng Chảy Riêng (
                <span className="font-serif italic">λ</span>)
              </h1>
              <p className="text-sm sm:text-base text-slate-600 max-w-lg mx-auto">
                Mô phỏng quá trình đun nóng chảy nước đá và tự động tính toán
                kết quả thực nghiệm.
              </p>
            </header>

            {/* Main Responsive Grid Layout */}
            <div className="grid grid-cols-1 lg:grid-cols-12 gap-6 w-full max-w-7xl pb-10">
              {/* LEFT COLUMN: Controls & Visuals */}
              <div className="lg:col-span-5 flex flex-col gap-6">
                {/* Controls */}
                <div className="bg-white p-4 sm:p-5 rounded-xl shadow-md border border-slate-200">
                  <h3 className="font-bold text-slate-700 mb-3 flex items-center gap-2">
                    <Icons.FlaskConical className="w-5 h-5" /> Thiết lập Thí
                    nghiệm
                  </h3>
                  <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                    <div>
                      <label className="block text-xs sm:text-sm font-medium text-slate-600 mb-1">
                        Khối lượng đá{" "}
                        <span className="font-serif italic text-slate-800">
                          (m)
                        </span>
                      </label>
                      <div className="flex items-center group">
                        <input
                          type="number"
                          value={mass}
                          onChange={(e) => setMass(Number(e.target.value))}
                          disabled={isRunning || simTime > 0}
                          step="0.05"
                          min="0.05"
                          className="w-full px-3 py-3 sm:py-2 border border-slate-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-100 font-mono text-blue-700 font-bold transition-colors text-base sm:text-sm"
                        />
                        <span className="bg-slate-100 px-3 py-3 sm:py-2 border border-l-0 border-slate-300 rounded-r-lg text-slate-600 text-sm font-semibold group-hover:bg-slate-200 transition-colors">
                          kg
                        </span>
                      </div>
                    </div>
                    <div>
                      <label className="block text-xs sm:text-sm font-medium text-slate-600 mb-1">
                        Công suất bếp{" "}
                        <span className="font-serif italic text-slate-800">
                          (P)
                        </span>
                      </label>
                      <div className="flex items-center group">
                        <input
                          type="number"
                          value={power}
                          onChange={(e) => setPower(Number(e.target.value))}
                          disabled={isRunning || simTime > 0}
                          step="50"
                          min="50"
                          className="w-full px-3 py-3 sm:py-2 border border-slate-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-slate-100 font-mono text-red-600 font-bold transition-colors text-base sm:text-sm"
                        />
                        <span className="bg-slate-100 px-3 py-3 sm:py-2 border border-l-0 border-slate-300 rounded-r-lg text-slate-600 text-sm font-semibold group-hover:bg-slate-200 transition-colors">
                          W
                        </span>
                      </div>
                    </div>
                  </div>
                  <div className="flex gap-2 sm:gap-3">
                    {!isRunning ? (
                      <button
                        onClick={() => setIsRunning(true)}
                        disabled={temp >= TARGET_TEMP}
                        className={`flex-1 flex items-center justify-center gap-2 px-4 py-3 sm:py-2 rounded-lg text-white font-semibold shadow transition-all active:scale-95 text-sm sm:text-base ${
                          temp >= TARGET_TEMP
                            ? "bg-gray-400 cursor-not-allowed"
                            : "bg-green-600 hover:bg-green-700"
                        }`}
                      >
                        <Icons.Play className="w-5 h-5" />{" "}
                        {simTime === 0 ? "Bắt đầu đo" : "Tiếp tục"}
                      </button>
                    ) : (
                      <button
                        onClick={() => setIsRunning(false)}
                        className="flex-1 flex items-center justify-center gap-2 px-4 py-3 sm:py-2 bg-amber-500 hover:bg-amber-600 text-white rounded-lg font-semibold shadow transition-all active:scale-95 text-sm sm:text-base"
                      >
                        <Icons.Pause className="w-5 h-5" /> Tạm dừng
                      </button>
                    )}
                    <button
                      onClick={handleReset}
                      className="px-4 py-3 sm:py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 rounded-lg font-semibold shadow transition-all active:scale-95"
                    >
                      <Icons.RotateCcw className="w-5 h-5" />
                    </button>
                  </div>
                </div>

                {/* Visuals - SCALABLE CONTAINER */}
                <div className="bg-white rounded-xl shadow-xl border border-slate-200 flex flex-col items-center relative overflow-hidden h-[400px] sm:h-[480px]">
                  <div
                    className="absolute inset-0 opacity-10 pointer-events-none"
                    style={{
                      backgroundImage:
                        "linear-gradient(#cbd5e1 1px, transparent 1px), linear-gradient(90deg, #cbd5e1 1px, transparent 1px)",
                      backgroundSize: "20px 20px",
                    }}
                  ></div>

                  {/* Monitors */}
                  <div className="w-full bg-slate-100 border-b border-slate-200 p-3 flex justify-between items-center z-30 shadow-sm sticky top-0">
                    <div className="flex gap-2 sm:gap-3">
                      <div className="bg-slate-800 text-green-400 font-mono px-2 sm:px-3 py-1 rounded border-2 border-slate-600 shadow-inner flex items-center gap-1 sm:gap-2 min-w-[80px] sm:min-w-[100px]">
                        <Icons.Clock className="text-slate-400 w-3 h-3 sm:w-4 sm:h-4" />
                        <span className="text-sm sm:text-lg tracking-wider leading-none">
                          {formatTimeDigital(simTime)}
                        </span>
                      </div>
                      <div className="bg-slate-800 text-red-400 font-mono px-2 sm:px-3 py-1 rounded border-2 border-slate-600 shadow-inner flex items-center gap-1 sm:gap-2 min-w-[80px] sm:min-w-[100px]">
                        <Icons.Thermometer className="text-slate-400 w-3 h-3 sm:w-4 sm:h-4" />
                        <span className="text-sm sm:text-lg tracking-wider leading-none">
                          {temp.toFixed(1)}°C
                        </span>
                      </div>
                    </div>
                    <div
                      className={`px-2 sm:px-3 py-1 rounded text-[10px] sm:text-xs font-bold border flex items-center gap-1 sm:gap-2 ${
                        phase === "SOLID"
                          ? "bg-blue-100 text-blue-800 border-blue-200"
                          : phase === "MELTING"
                          ? "bg-amber-100 text-amber-800 border-amber-200"
                          : "bg-red-100 text-red-800 border-red-200"
                      }`}
                    >
                      <div
                        className={`w-1.5 h-1.5 sm:w-2 sm:h-2 rounded-full ${
                          phase === "MELTING"
                            ? "animate-ping bg-amber-600"
                            : "bg-current"
                        }`}
                      ></div>
                      {phase === "SOLID"
                        ? "RẮN"
                        : phase === "MELTING"
                        ? "NÓNG CHẢY"
                        : "LỎNG"}
                    </div>
                  </div>

                  {/* Scaled Scene Container */}
                  <div className="relative flex-1 w-full flex justify-center items-end pb-4 sm:pb-8 origin-bottom scale-[0.8] sm:scale-100 transition-transform duration-300">
                    {/* Retort Stand */}
                    <div className="absolute right-[2%] bottom-0 flex flex-col items-center z-0">
                      <div className="w-40 h-5 bg-gradient-to-b from-slate-600 to-slate-800 rounded shadow-lg z-10"></div>
                      <div className="w-3 h-[420px] bg-gradient-to-r from-slate-600 via-slate-400 to-slate-600 rounded-t shadow-md absolute bottom-4 right-8"></div>
                      <div className="absolute bottom-[280px] right-8 z-20">
                        <div className="absolute -right-1.5 -top-1 w-6 h-8 bg-gradient-to-br from-slate-700 to-slate-500 rounded shadow border border-slate-600"></div>
                        <div className="absolute top-2 right-2 w-16 h-2.5 bg-gradient-to-b from-slate-500 via-slate-300 to-slate-500 rounded shadow-sm"></div>
                        <div className="absolute top-0 left-[-45px] w-3 h-8 bg-slate-600 rounded-sm flex flex-col justify-between">
                          <div className="w-8 h-1 bg-slate-600 -ml-2.5 rounded-full"></div>
                          <div className="w-8 h-1 bg-slate-600 -ml-2.5 rounded-full"></div>
                        </div>
                      </div>
                    </div>

                    {/* Thermometer */}
                    <div className="absolute left-[calc(50%+110px)] bottom-[140px] z-20 flex flex-col items-center drop-shadow-lg">
                      <div className="w-3 h-[300px] bg-amber-50/80 rounded-full border border-slate-300/80 shadow-inner relative overflow-hidden backdrop-blur-sm">
                        <div className="absolute top-0 left-0.5 w-1 h-full bg-white/40 blur-[0.5px] z-20"></div>
                        <div
                          className="absolute bottom-0 left-1 right-1 bg-red-600 transition-all duration-300 ease-linear mx-auto rounded-t-sm opacity-90"
                          style={{
                            height: `${getThermometerHeight(temp)}%`,
                            boxShadow: "0 0 4px rgba(220, 38, 38, 0.5)",
                          }}
                        ></div>
                        {[...Array(25)].map((_, i) => (
                          <div
                            key={i}
                            className={`absolute w-1.5 ${
                              i % 5 === 0
                                ? "h-[1.5px] w-2 bg-slate-800"
                                : "h-[1px] bg-slate-400"
                            } right-0`}
                            style={{ bottom: `${i * 4}%` }}
                          ></div>
                        ))}
                      </div>
                      <div
                        className="w-6 h-6 rounded-full -mt-2 shadow-md border border-red-800 relative z-10"
                        style={{
                          background:
                            "radial-gradient(circle at 30% 30%, #ef4444, #991b1b)",
                        }}
                      ></div>
                      <div className="absolute top-[80%] right-[120%] flex items-center animate-pulse">
                        <Icons.ArrowLeft
                          className="text-red-500 w-6 h-6"
                          strokeWidth={3}
                        />
                        <div className="text-xs font-bold text-red-600 whitespace-nowrap bg-white/80 px-1 rounded shadow-sm ml-1">
                          Đo cốc
                        </div>
                      </div>
                    </div>

                    {/* Stirrer */}
                    <div className="absolute left-[50%] bottom-[150px] w-1.5 h-[240px] bg-gradient-to-r from-slate-300/40 via-white/60 to-slate-300/40 rounded-full transform -rotate-6 z-10 border border-white/20 backdrop-blur-sm origin-bottom"></div>

                    {/* Beaker */}
                    <div className="relative w-52 h-64 z-10 mb-[100px]">
                      <div className="absolute inset-0 border-l-[1px] border-r-[1px] border-b-4 border-slate-300/60 rounded-b-2xl bg-gradient-to-br from-blue-50/5 via-white/5 to-slate-100/10 backdrop-blur-[1px] overflow-hidden shadow-[inset_0_0_20px_rgba(255,255,255,0.2)]">
                        <div className="absolute top-0 left-0 right-0 h-1 bg-slate-300/30"></div>
                        <div className="absolute right-0 top-12 flex flex-col items-end gap-8 opacity-60 pr-2">
                          <div className="flex items-center gap-1">
                            <span className="text-[9px] font-bold text-slate-500 font-mono">
                              200ml
                            </span>
                            <div className="w-3 h-[1px] bg-slate-500"></div>
                          </div>
                          <div className="flex items-center gap-1">
                            <span className="text-[9px] font-bold text-slate-500 font-mono">
                              150ml
                            </span>
                            <div className="w-2 h-[1px] bg-slate-500"></div>
                          </div>
                          <div className="flex items-center gap-1">
                            <span className="text-[9px] font-bold text-slate-500 font-mono">
                              100ml
                            </span>
                            <div className="w-3 h-[1px] bg-slate-500"></div>
                          </div>
                          <div className="flex items-center gap-1">
                            <span className="text-[9px] font-bold text-slate-500 font-mono">
                              50ml
                            </span>
                            <div className="w-2 h-[1px] bg-slate-500"></div>
                          </div>
                        </div>
                        <div
                          className="absolute bottom-0 left-0 right-0 transition-all duration-1000 border-t border-blue-300/50"
                          style={{
                            height:
                              phase === "SOLID"
                                ? "30%"
                                : phase === "MELTING"
                                ? `${30 + meltingProgress * 0.3}%`
                                : "60%",
                            background:
                              "linear-gradient(to bottom, rgba(147, 197, 253, 0.4), rgba(59, 130, 246, 0.2))",
                            boxShadow:
                              "inset 0 4px 6px -1px rgba(147, 197, 253, 0.3)",
                          }}
                        >
                          <div className="absolute top-0 left-0 right-0 h-1 bg-gradient-to-b from-white/40 to-transparent"></div>
                          {phase === "LIQUID" && temp > 10 && (
                            <div className="absolute inset-0 overflow-hidden">
                              {[...Array(8)].map((_, i) => (
                                <div
                                  key={i}
                                  className="absolute bg-white/40 rounded-full animate-bounce"
                                  style={{
                                    width: Math.random() * 4 + 2 + "px",
                                    height: Math.random() * 4 + 2 + "px",
                                    left: Math.random() * 90 + 5 + "%",
                                    bottom: "-10px",
                                    animationDuration: `${
                                      Math.random() * 2 + 1
                                    }s`,
                                    animationDelay: `${Math.random() * 2}s`,
                                  }}
                                ></div>
                              ))}
                            </div>
                          )}
                        </div>
                        {phase !== "LIQUID" && (
                          <div className="absolute bottom-2 left-0 right-0 flex justify-center flex-wrap gap-2 px-6 pb-2">
                            {[...Array(6)].map((_, i) => (
                              <div
                                key={i}
                                className="relative transition-all duration-500"
                                style={{
                                  width:
                                    phase === "MELTING"
                                      ? `${32 * (1 - meltingProgress / 120)}px`
                                      : "32px",
                                  height:
                                    phase === "MELTING"
                                      ? `${32 * (1 - meltingProgress / 120)}px`
                                      : "32px",
                                  opacity: phase === "MELTING" ? 0.8 : 0.9,
                                  transform: `rotate(${
                                    i * 25 + meltingProgress
                                  }deg) translateY(${
                                    phase === "MELTING"
                                      ? meltingProgress / 4
                                      : 0
                                  }px)`,
                                }}
                              >
                                <div className="absolute inset-0 bg-gradient-to-br from-white/80 to-blue-200/40 border border-white/60 rounded-sm shadow-sm backdrop-blur-sm"></div>
                              </div>
                            ))}
                          </div>
                        )}
                        {temp > 40 && (
                          <div className="absolute -top-16 inset-x-0 h-24 flex justify-center gap-4 opacity-40 pointer-events-none">
                            {[...Array(3)].map((_, i) => (
                              <div
                                key={i}
                                className="w-8 h-full bg-gradient-to-t from-white/0 via-white/30 to-white/0 blur-xl rounded-full animate-pulse"
                                style={{
                                  animationDelay: `${i * 0.5}s`,
                                  transform: `translateY(${-i * 10}px)`,
                                }}
                              ></div>
                            ))}
                          </div>
                        )}
                      </div>
                    </div>

                    {/* Tripod */}
                    <div className="absolute bottom-0 w-44 h-32 pointer-events-none flex justify-center z-0">
                      <div className="absolute top-0 w-full h-1.5 bg-slate-400 z-10 rounded shadow-sm"></div>
                      <div className="absolute top-1 left-4 w-2.5 h-32 bg-gradient-to-b from-slate-600 to-slate-800 -skew-x-12 origin-top rounded-b shadow-sm"></div>
                      <div className="absolute top-1 right-4 w-2.5 h-32 bg-gradient-to-b from-slate-600 to-slate-800 skew-x-12 origin-top rounded-b shadow-sm"></div>
                      <div className="absolute top-1 left-1/2 -translate-x-1/2 w-2.5 h-32 bg-gradient-to-b from-slate-700 to-slate-900 opacity-60 z-[-1] rounded-b"></div>
                    </div>

                    {/* Burner */}
                    <div className="absolute bottom-0 flex flex-col items-center z-20">
                      {isRunning && (
                        <div className="mb-[-5px] relative filter drop-shadow-[0_0_12px_rgba(59,130,246,0.6)]">
                          <div className="absolute bottom-1 left-1/2 -translate-x-1/2 w-4 h-12 bg-blue-500/80 blur-[2px] rounded-full animate-pulse"></div>
                          <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-8 h-16 bg-gradient-to-t from-blue-400/50 to-transparent blur-md rounded-full"></div>
                        </div>
                      )}
                      <div className="w-5 h-14 bg-gradient-to-r from-slate-700 via-slate-500 to-slate-700 rounded-t-sm shadow-md border-x border-slate-600"></div>
                      <div className="w-6 h-2 bg-yellow-600/80 mt-[-10px] z-20"></div>
                      <div className="w-16 h-3 bg-gradient-to-b from-slate-700 to-slate-900 rounded-t-lg rounded-b-sm shadow-lg border-t border-slate-600"></div>
                    </div>
                  </div>
                </div>
              </div>

              {/* RIGHT COLUMN: Graph & Data */}
              <div className="lg:col-span-7 space-y-6">
                {/* Graph Container */}
                <div className="bg-white p-4 sm:p-5 rounded-xl shadow-md border border-slate-200 flex flex-col relative h-[350px] sm:h-[400px]">
                  <div className="flex justify-between items-center mb-4 flex-wrap gap-2">
                    <h3 className="font-bold text-slate-700 flex items-center gap-2 text-sm sm:text-base">
                      <Icons.Info className="w-4 h-4" /> Đồ thị Nhiệt độ (
                      <i className="font-serif">T</i>) - Thời gian (
                      <i className="font-serif">t</i>)
                    </h3>
                    <div className="flex flex-wrap gap-2 text-[10px] sm:text-xs bg-slate-50 px-2 py-1 rounded border border-slate-200">
                      <div className="flex items-center gap-1">
                        <div className="w-2 h-2 sm:w-3 sm:h-1 bg-blue-500 rounded-full"></div>
                        <span className="text-blue-700 font-medium">Rắn</span>
                      </div>
                      <div className="flex items-center gap-1">
                        <div className="w-2 h-2 sm:w-3 sm:h-1 bg-amber-500 rounded-full"></div>
                        <span className="text-amber-700 font-medium">
                          Nóng chảy
                        </span>
                      </div>
                      <div className="flex items-center gap-1">
                        <div className="w-2 h-2 sm:w-3 sm:h-1 bg-red-500 rounded-full"></div>
                        <span className="text-red-700 font-medium">Lỏng</span>
                      </div>
                    </div>
                  </div>
                  <div
                    ref={graphRef}
                    className="flex-1 relative border-l border-b border-slate-300 bg-slate-50 mr-4 mb-6 cursor-crosshair overflow-hidden"
                    onMouseMove={handleGraphMouseMove}
                    onMouseLeave={handleGraphMouseLeave}
                  >
                    {/* Grid Lines */}
                    {[...Array(9)].map((_, i) => {
                      const val = GRAPH_MIN_Y + (GRAPH_Y_RANGE / 8) * i;
                      const y = getYPos(val);
                      return (
                        <div
                          key={i}
                          className="absolute w-full border-t border-slate-200 border-dashed pointer-events-none"
                          style={{ top: `${y}%` }}
                        >
                          {i % 2 === 0 && (
                            <span className="absolute -left-8 -top-2 text-[10px] text-slate-400 font-mono w-6 text-right">
                              {val}
                            </span>
                          )}
                        </div>
                      );
                    })}
                    {[...Array(6)].map((_, i) => {
                      const val = (maxTimeAxis / 5) * i;
                      const x = getXPos(val);
                      return (
                        <div
                          key={i}
                          className="absolute h-full border-l border-slate-200 border-dashed pointer-events-none"
                          style={{ left: `${x}%` }}
                        >
                          <span className="absolute -bottom-5 -left-3 text-[10px] text-slate-400 font-mono">
                            {Math.round(val)}
                          </span>
                        </div>
                      );
                    })}

                    <div
                      className="absolute w-full border-t border-blue-200 pointer-events-none"
                      style={{ top: `${getYPos(0)}%` }}
                    ></div>

                    <svg
                      className="absolute inset-0 w-full h-full pointer-events-none"
                      viewBox="0 0 100 100"
                      preserveAspectRatio="none"
                    >
                      {graphData.map((pt, i) => {
                        if (i === graphData.length - 1) return null;
                        const nextPt = graphData[i + 1];
                        const strokeColor =
                          pt.phase === "SOLID"
                            ? "#3b82f6"
                            : pt.phase === "MELTING"
                            ? "#f59e0b"
                            : "#ef4444";
                        return (
                          <line
                            key={i}
                            x1={getXPos(pt.timeMin)}
                            y1={getYPos(pt.temp)}
                            x2={getXPos(nextPt.timeMin)}
                            y2={getYPos(nextPt.temp)}
                            stroke={strokeColor}
                            strokeWidth="1"
                            strokeLinecap="round"
                          />
                        );
                      })}
                    </svg>

                    {/* Interactive Tooltip */}
                    {hoverInfo && (
                      <>
                        <div
                          className="absolute top-0 bottom-0 border-l border-slate-500 border-dashed pointer-events-none z-10"
                          style={{ left: `${hoverInfo.x}%` }}
                        ></div>
                        <div
                          className="absolute left-0 right-0 border-t border-slate-500 border-dashed pointer-events-none z-10"
                          style={{ top: `${hoverInfo.y}%` }}
                        ></div>
                        <div
                          className={`absolute w-3 h-3 border-2 rounded-full z-20 pointer-events-none transform -translate-x-1/2 -translate-y-1/2 shadow-sm bg-white ${
                            hoverInfo.phase === "SOLID"
                              ? "border-blue-500"
                              : hoverInfo.phase === "MELTING"
                              ? "border-amber-500"
                              : "border-red-500"
                          }`}
                          style={{
                            left: `${hoverInfo.x}%`,
                            top: `${hoverInfo.y}%`,
                          }}
                        ></div>
                        <div
                          className="absolute z-30 bg-slate-800 text-white text-xs rounded px-2 py-1 shadow-lg pointer-events-none whitespace-nowrap"
                          style={{
                            left: `${hoverInfo.x}%`,
                            top: `${hoverInfo.y}%`,
                            transform: `translate(${
                              hoverInfo.x > 80 ? "-110%" : "10px"
                            }, ${hoverInfo.y < 20 ? "10px" : "-130%"})`,
                          }}
                        >
                          <div className="font-bold mb-0.5">
                            Thời gian: {hoverInfo.time.toFixed(1)} phút
                          </div>
                          <div
                            className={`${
                              hoverInfo.phase === "SOLID"
                                ? "text-blue-200"
                                : hoverInfo.phase === "MELTING"
                                ? "text-amber-200"
                                : "text-red-200"
                            }`}
                          >
                            Nhiệt độ: {hoverInfo.temp.toFixed(1)}°C
                          </div>
                        </div>
                      </>
                    )}
                  </div>
                  <div className="absolute bottom-2 right-4 text-xs font-bold text-slate-500">
                    t (phút)
                  </div>
                  <div className="absolute top-12 left-1 text-xs font-bold text-slate-500">
                    T (°C)
                  </div>
                </div>

                {/* Results Table */}
                <div className="bg-white p-4 sm:p-5 rounded-xl shadow-md border border-slate-200 flex flex-col h-[300px] sm:h-[350px]">
                  <div className="flex justify-between items-center mb-4">
                    <h3 className="font-bold text-slate-700 flex items-center gap-2 text-sm sm:text-base">
                      <Icons.Calculator className="w-4 h-4" /> Bảng Kết Quả
                    </h3>
                    <button
                      onClick={handleClearData}
                      className="text-xs text-red-500 hover:text-red-700 underline px-2 py-1"
                    >
                      Xóa dữ liệu
                    </button>
                  </div>
                  <div className="flex-1 overflow-auto border rounded-lg">
                    <table className="w-full text-xs sm:text-sm text-left whitespace-nowrap">
                      <thead className="bg-slate-100 text-slate-600 font-semibold sticky top-0 z-10">
                        <tr>
                          <th className="px-2 py-2 text-center">Lần</th>
                          <th className="px-2 py-2">m (kg)</th>
                          <th className="px-2 py-2">P (W)</th>
                          <th className="px-2 py-2 text-right">t (s)</th>
                          <th className="px-2 py-2 text-right">λ (J/kg)</th>
                        </tr>
                      </thead>
                      <tbody className="divide-y divide-slate-100">
                        {experimentResults.length === 0 ? (
                          <tr>
                            <td
                              colSpan={5}
                              className="px-4 py-8 text-center text-slate-400 italic"
                            >
                              Chưa có dữ liệu.
                            </td>
                          </tr>
                        ) : (
                          experimentResults.map((row) => (
                            <tr key={row.id} className="hover:bg-blue-50">
                              <td className="px-2 py-2 text-center font-medium text-slate-700">
                                {row.id}
                              </td>
                              <td className="px-2 py-2">{row.mass}</td>
                              <td className="px-2 py-2">{row.power}</td>
                              <td className="px-2 py-2 text-right font-mono text-blue-600">
                                {formatNumber(row.timeDuration)}
                              </td>
                              <td className="px-2 py-2 text-right font-mono font-bold text-green-600">
                                {formatNumber(row.lambda)}
                              </td>
                            </tr>
                          ))
                        )}
                      </tbody>
                    </table>
                  </div>
                  <div className="mt-4 pt-4 border-t border-slate-100 bg-yellow-50 p-3 rounded-lg flex justify-between items-center">
                    <span className="text-xs sm:text-sm font-semibold text-yellow-800">
                      Giá trị trung bình (λ):
                    </span>
                    <div className="text-sm sm:text-xl font-bold text-yellow-700">
                      {experimentResults.length > 0
                        ? `${formatNumber(getAverageLambda())} J/kg`
                        : "---"}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<IceMeltingSim />);
    </script>

    <!-- Elfsight AI Chatbot | Untitled AI Chatbot -->
    <script src="https://elfsightcdn.com/platform.js" async></script>
    <div
      class="elfsight-app-131656ee-bb10-4a92-a766-86c412c36d15"
      data-elfsight-app-lazy
    ></div>
  </body>
</html>
