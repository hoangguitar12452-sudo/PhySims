<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PhySim - Mô Phỏng Đo Nhiệt Hóa Hơi Riêng</title>

    <!-- Tải Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tải React và ReactDOM -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.development.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
    ></script>

    <!-- Tải Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #f1f5f9;
        color: #0f172a;
        overflow-x: hidden;
      }
      .font-mono {
        font-family: "JetBrains Mono", monospace;
      }

      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 10px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      @keyframes boiling {
        0% {
          transform: translateY(0) scale(1);
          opacity: 0.6;
        }
        50% {
          opacity: 0.8;
        }
        100% {
          transform: translateY(-150px) scale(1.5);
          opacity: 0;
        }
      }

      .glass-panel {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
          0 2px 4px -1px rgba(0, 0, 0, 0.06);
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      // --- ICONS ---
      const IconBase = ({ children, size = 18, className = "" }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          {children}
        </svg>
      );
      const Zap = (props) => (
        <IconBase {...props}>
          <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
        </IconBase>
      );
      const Scale = (props) => (
        <IconBase {...props}>
          <path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z" />
          <path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z" />
          <path d="M7 21h10" />
          <path d="M12 3v18" />
          <path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2" />
        </IconBase>
      );
      const Thermometer = (props) => (
        <IconBase {...props}>
          <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z" />
        </IconBase>
      );
      const AlertTriangle = (props) => (
        <IconBase {...props}>
          <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
          <path d="M12 9v4" />
          <path d="M12 17h.01" />
        </IconBase>
      );
      const Play = (props) => (
        <IconBase {...props}>
          <polygon points="5 3 19 12 5 21 5 3" />
        </IconBase>
      );
      const Pause = (props) => (
        <IconBase {...props}>
          <rect width="4" height="16" x="6" y="4" />
          <rect width="4" height="16" x="14" y="4" />
        </IconBase>
      );
      const Save = (props) => (
        <IconBase {...props}>
          <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
          <polyline points="17 21 17 13 7 13 7 21" />
          <polyline points="7 3 7 8 15 8" />
        </IconBase>
      );
      const RotateCcw = (props) => (
        <IconBase {...props}>
          <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" />
          <path d="M3 3v5h5" />
        </IconBase>
      );
      const Calculator = (props) => (
        <IconBase {...props}>
          <rect width="16" height="20" x="4" y="2" rx="2" />
          <line x1="8" x2="16" y1="6" y2="6" />
          <line x1="16" x2="16" y1="14" y2="18" />
          <path d="M16 10h.01" />
          <path d="M12 10h.01" />
          <path d="M8 10h.01" />
          <path d="M12 14h.01" />
          <path d="M8 14h.01" />
          <path d="M12 18h.01" />
          <path d="M8 18h.01" />
        </IconBase>
      );
      const Settings = (props) => (
        <IconBase {...props}>
          <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z" />
          <circle cx="12" cy="12" r="3" />
        </IconBase>
      );
      const Beaker = (props) => (
        <IconBase {...props}>
          <path d="M4.5 3h15" />
          <path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3" />
          <path d="M6 14h12" />
        </IconBase>
      );
      const Flame = (props) => (
        <IconBase {...props}>
          <path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.148-.224-4.078.123-5.408A5.158 5.158 0 0 0 6 6a5 5 0 1 0 10.5 7.319c-.318.895-.896 1.789-1.5 2.609-3.051 4.192-5.713 3.084-5.738 2.106C8.75 19.412 12.333 18.25 12.333 16a2.5 2.5 0 0 0-3.333-3.832" />
        </IconBase>
      );
      const Timer = (props) => (
        <IconBase {...props}>
          <line x1="10" x2="14" y1="2" y2="2" />
          <line x1="12" x2="15" y1="14" y2="11" />
          <circle cx="12" cy="14" r="8" />
        </IconBase>
      );
      const Info = (props) => (
        <IconBase {...props}>
          <circle cx="12" cy="12" r="10" />
          <path d="M12 16v-4" />
          <path d="M12 8h.01" />
        </IconBase>
      );
      const Maximize = (props) => (
        <IconBase {...props}>
          <path d="M8 3H5a2 2 0 0 0-2 2v3" />
          <path d="M21 8V5a2 2 0 0 0-2-2h-3" />
          <path d="M3 16v3a2 2 0 0 0 2 2h3" />
          <path d="M16 21h3a2 2 0 0 0 2-2v-3" />
        </IconBase>
      );
      const Minimize = (props) => (
        <IconBase {...props}>
          <path d="M8 3v3a2 2 0 0 1-2 2H3" />
          <path d="M21 8h-3a2 2 0 0 1-2-2V3" />
          <path d="M3 16h3a2 2 0 0 1 2 2v3" />
          <path d="M16 21v-3a2 2 0 0 1 2-2h3" />
        </IconBase>
      );

      // --- GLOBAL UTILS ---
      const formatTime = (t) => {
        const m = Math.floor(t / 60);
        const s = Math.floor(t % 60);
        return `${m.toString().padStart(2, "0")}:${s
          .toString()
          .padStart(2, "0")}`;
      };

      // --- UI COMPONENTS ---
      const InputGroup = ({
        label,
        icon: Icon,
        name,
        value,
        unit,
        min,
        max,
        step = 1,
        disabled,
        onChange,
      }) => (
        <div
          className={`transition-all duration-200 ${
            disabled ? "opacity-60 grayscale" : "opacity-100"
          }`}
        >
          <label className="text-xs uppercase tracking-wide font-bold text-slate-500 mb-1.5 flex items-center gap-2">
            {label}
          </label>
          <div className="relative group">
            <div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
              {Icon && <Icon size={16} />}
            </div>
            <input
              type="number"
              name={name}
              value={value}
              onChange={onChange}
              disabled={disabled}
              min={min}
              max={max}
              step={step}
              className="w-full pl-9 pr-8 py-2.5 bg-slate-50 border border-slate-200 text-slate-800 text-sm rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500/50 focus:border-indigo-500 transition-all font-mono font-medium placeholder-slate-300 hover:bg-white disabled:bg-slate-100"
              placeholder="0"
            />
            <span className="absolute right-3 top-1/2 -translate-y-1/2 text-xs font-bold text-slate-400 select-none pointer-events-none">
              {unit}
            </span>
          </div>
        </div>
      );

      // --- MAIN APP ---
      const HeatVaporizationLab = () => {
        const SPECIFIC_HEAT_WATER = 4186;
        const LATENT_HEAT_THEORY = 2260000;

        const [config, setConfig] = useState({
          power: 60,
          initialMass: 200,
          initialTemp: 25,
          efficiency: 90,
        });

        const [isRunning, setIsRunning] = useState(false);
        const [time, setTime] = useState(0);
        const [temp, setTemp] = useState(config.initialTemp);
        const [mass, setMass] = useState(config.initialMass / 1000);
        const [isFullscreen, setIsFullscreen] = useState(false);

        const [dataPoints, setDataPoints] = useState([]);
        const [selectedPoints, setSelectedPoints] = useState([]);
        const [calculationResult, setCalculationResult] = useState(null);

        const step = 0.1;

        useEffect(() => {
          if (!isRunning && time === 0) {
            if (typeof config.initialTemp === "number")
              setTemp(config.initialTemp);
            if (typeof config.initialMass === "number")
              setMass(config.initialMass / 1000);
          }
        }, [config]);

        useEffect(() => {
          let interval = null;
          if (isRunning) {
            interval = setInterval(() => {
              setTime((t) => t + step);
              const p =
                (Number(config.power) || 0) *
                ((Number(config.efficiency) || 0) / 100);
              setTemp((prev) => {
                if (prev < 100) {
                  const m = mass > 0 ? mass : 0.001;
                  return Math.min(
                    100,
                    prev + (p * step) / (m * SPECIFIC_HEAT_WATER)
                  );
                }
                return 100;
              });
              setMass((prev) => {
                if (temp >= 100) {
                  return Math.max(0, prev - (p * step) / LATENT_HEAT_THEORY);
                }
                return prev;
              });
            }, 100);
          }
          return () => clearInterval(interval);
        }, [isRunning, temp, mass, config]);

        const handleReset = () => {
          setIsRunning(false);
          setTime(0);
          setTemp(
            typeof config.initialTemp === "number" ? config.initialTemp : 25
          );
          setMass(
            typeof config.initialMass === "number"
              ? config.initialMass / 1000
              : 0.2
          );
          setDataPoints([]);
          setSelectedPoints([]);
          setCalculationResult(null);
        };

        const handleRecordData = () => {
          setDataPoints((prev) => [
            ...prev,
            {
              id: Date.now(),
              time: parseFloat(time.toFixed(1)),
              mass: parseFloat((mass * 1000).toFixed(2)),
              temp: parseFloat(temp.toFixed(1)),
            },
          ]);
        };

        const toggleSelection = (id) => {
          setSelectedPoints((prev) => {
            if (prev.includes(id)) return prev.filter((p) => p !== id);
            return prev.length < 2 ? [...prev, id] : [prev[1], id];
          });
        };

        const calculateResults = () => {
          if (selectedPoints.length !== 2) return;
          const [p1, p2] = dataPoints
            .filter((p) => selectedPoints.includes(p.id))
            .sort((a, b) => a.time - b.time);

          if (p1.temp < 99.5 || p2.temp < 99.5) {
            alert(
              "Lưu ý: Chỉ nên chọn các điểm dữ liệu khi nước đã sôi (100°C) để tính nhiệt hóa hơi."
            );
          }

          const deltaT = p2.time - p1.time;
          const deltaM_kg = (p1.mass - p2.mass) / 1000;

          if (deltaM_kg <= 0.00001) {
            alert(
              "Khối lượng thay đổi không đáng kể. Vui lòng chọn khoảng thời gian xa hơn."
            );
            return;
          }

          setCalculationResult({
            L: (Number(config.power) * deltaT) / deltaM_kg,
            deltaT,
            deltaM_g: deltaM_kg * 1000,
            p_used: Number(config.power),
          });
        };

        const handleConfigChange = (e) => {
          const val = e.target.value === "" ? "" : parseFloat(e.target.value);
          setConfig((prev) => ({ ...prev, [e.target.name]: val }));
          if (!isRunning && val !== "" && !isNaN(val)) {
            if (e.target.name === "initialTemp") setTemp(val);
            if (e.target.name === "initialMass") setMass(val / 1000);
          }
        };

        return (
          <div className="min-h-screen flex flex-col font-sans text-slate-800 bg-[#f8fafc] overflow-hidden">
            {/* Header Compact */}
            <header className="bg-white border-b border-slate-200 h-16 shrink-0 shadow-sm z-50">
              <div className="max-w-[1600px] mx-auto px-6 h-full flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="bg-gradient-to-br from-indigo-600 to-blue-600 w-10 h-10 rounded-lg flex items-center justify-center text-white shadow-md shadow-indigo-200">
                    <Beaker size={22} strokeWidth={2.5} />
                  </div>
                  <div>
                    <h1 className="text-base font-extrabold text-slate-900 uppercase tracking-wide">
                      PHYSIM
                    </h1>
                    <p className="text-xs text-slate-500 font-medium truncate">
                      Thực hành: Nhiệt Hóa Hơi Riêng Của Nước
                    </p>
                  </div>
                </div>

                <div className="flex items-center gap-4">
                  <div className="flex flex-col items-end pr-1">
                    <span className="text-[10px] font-bold text-slate-400 uppercase tracking-widest">
                      Trạng thái
                    </span>
                    <div
                      className={`flex items-center gap-2 text-sm font-bold ${
                        isRunning ? "text-emerald-600" : "text-slate-500"
                      }`}
                    >
                      <span
                        className={`w-2.5 h-2.5 rounded-full ${
                          isRunning
                            ? "bg-emerald-500 animate-pulse shadow-[0_0_8px_rgba(16,185,129,0.5)]"
                            : "bg-slate-300"
                        }`}
                      ></span>
                      {isRunning ? "ĐANG CHẠY" : "ĐÃ DỪNG"}
                    </div>
                  </div>
                </div>
              </div>
            </header>

            {/* Main Content: Flexible Dashboard Layout */}
            <main className="flex-1 w-full max-w-[1600px] mx-auto p-4 lg:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6 h-auto lg:h-[calc(100vh-4rem)] overflow-y-auto lg:overflow-hidden">
              {/* LEFT: Controls (Scrollable on Desktop if needed) */}
              <div className="order-2 lg:order-1 col-span-12 lg:col-span-3 flex flex-col gap-4 h-auto lg:h-full lg:overflow-y-auto custom-scrollbar pb-2">
                {/* Panel: Thông số */}
                <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden shrink-0">
                  <div className="bg-slate-50/80 px-5 py-3 border-b border-slate-200 flex justify-between items-center">
                    <h3 className="text-sm font-bold text-slate-700 uppercase tracking-wide flex items-center gap-2">
                      <Settings size={14} className="text-slate-500" /> Thông số
                      đầu vào
                    </h3>
                  </div>
                  <div className="p-5 space-y-4">
                    <InputGroup
                      label="Công suất (P)"
                      icon={Zap}
                      name="power"
                      value={config.power}
                      unit="W"
                      disabled={isRunning}
                      onChange={handleConfigChange}
                    />
                    <InputGroup
                      label="Khối lượng (m)"
                      icon={Scale}
                      name="initialMass"
                      value={config.initialMass}
                      unit="g"
                      disabled={isRunning}
                      onChange={handleConfigChange}
                    />
                    <InputGroup
                      label="Nhiệt độ (t₀)"
                      icon={Thermometer}
                      name="initialTemp"
                      value={config.initialTemp}
                      unit="°C"
                      disabled={isRunning}
                      max={99}
                      onChange={handleConfigChange}
                    />

                    <div
                      className={`pt-3 border-t border-slate-100 ${
                        isRunning ? "opacity-50 pointer-events-none" : ""
                      }`}
                    >
                      <div className="flex justify-between items-end mb-2">
                        <label className="text-xs font-bold text-slate-500 uppercase flex items-center gap-1">
                          <AlertTriangle
                            size={12}
                            className="text-orange-500"
                          />{" "}
                          Hiệu suất
                        </label>
                        <span className="text-sm font-mono font-bold text-indigo-600 bg-indigo-50 px-2 py-0.5 rounded border border-indigo-100">
                          {config.efficiency}%
                        </span>
                      </div>
                      <input
                        type="range"
                        name="efficiency"
                        min="50"
                        max="100"
                        value={config.efficiency}
                        onChange={handleConfigChange}
                        className="w-full h-1.5 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-indigo-600 hover:accent-indigo-700"
                      />
                    </div>
                  </div>
                </div>

                {/* Panel: Điều khiển */}
                <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden shrink-0">
                  <div className="bg-slate-50/80 px-5 py-3 border-b border-slate-200">
                    <h3 className="text-sm font-bold text-slate-700 uppercase tracking-wide flex items-center gap-2">
                      <Play size={14} className="text-slate-500" /> Điều khiển
                    </h3>
                  </div>
                  <div className="p-5 flex flex-col gap-3">
                    <button
                      onClick={() => setIsRunning(!isRunning)}
                      className={`w-full py-3.5 rounded-lg font-bold shadow-sm flex items-center justify-center gap-2 text-base transition-all active:scale-[0.98] ${
                        isRunning
                          ? "bg-amber-50 text-amber-700 border border-amber-200 hover:bg-amber-100"
                          : "bg-indigo-600 text-white hover:bg-indigo-700 border border-transparent hover:shadow-indigo-200"
                      }`}
                    >
                      {isRunning ? (
                        <>
                          <Pause size={18} /> TẠM DỪNG
                        </>
                      ) : (
                        <>
                          <Play size={18} /> {time > 0 ? "TIẾP TỤC" : "BẮT ĐẦU"}
                        </>
                      )}
                    </button>

                    <div className="grid grid-cols-2 gap-3">
                      <button
                        onClick={handleRecordData}
                        disabled={!isRunning}
                        className="py-3 bg-white border border-slate-200 text-slate-700 rounded-lg font-bold text-xs uppercase tracking-wide hover:bg-slate-50 hover:border-slate-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 transition-all active:bg-slate-100 shadow-sm"
                      >
                        <Save size={16} /> Ghi số liệu
                      </button>
                      <button
                        onClick={handleReset}
                        className="py-3 bg-white border border-slate-200 text-slate-600 rounded-lg font-bold text-xs uppercase tracking-wide hover:bg-red-50 hover:text-red-600 hover:border-red-200 flex items-center justify-center gap-2 transition-all active:bg-red-100 shadow-sm"
                      >
                        <RotateCcw size={16} /> Làm mới
                      </button>
                    </div>
                  </div>
                </div>

                {/* Note */}
                <div className="bg-blue-50/50 border border-blue-100 p-4 rounded-lg text-xs text-blue-800/80 leading-relaxed flex gap-3 items-start shrink-0">
                  <div className="mt-0.5 shrink-0">
                    <Info size={16} />
                  </div>
                  <div>
                    Đợi nước sôi <strong>(100°C)</strong>, nhiệt độ ổn định rồi
                    mới bắt đầu ghi số liệu.
                  </div>
                </div>
              </div>

              {/* CENTER: Visualization (Order 1 on mobile, 2 on desktop) */}
              <div
                className={`col-span-12 lg:col-span-6 flex flex-col transition-all duration-500 ease-in-out ${
                  isFullscreen
                    ? "fixed inset-0 z-[100] bg-white p-6"
                    : "order-1 lg:order-2 h-[400px] lg:h-full"
                }`}
              >
                <div
                  className={`bg-white rounded-xl shadow-md border border-slate-200 relative overflow-hidden flex flex-col select-none group w-full h-full ${
                    isFullscreen ? "shadow-2xl ring-4 ring-indigo-500/20" : ""
                  }`}
                >
                  <button
                    onClick={() => setIsFullscreen(!isFullscreen)}
                    className="absolute top-4 right-4 z-20 p-2 bg-white/80 hover:bg-white rounded-lg shadow-sm border border-slate-200 text-slate-500 hover:text-indigo-600 transition-all opacity-0 group-hover:opacity-100 backdrop-blur-sm"
                    title={isFullscreen ? "Thu nhỏ" : "Phóng to toàn màn hình"}
                  >
                    {isFullscreen ? (
                      <Minimize size={24} />
                    ) : (
                      <Maximize size={24} />
                    )}
                  </button>

                  <div className="absolute top-4 left-4 z-10 flex gap-3 pointer-events-none">
                    <div className="glass-panel px-4 py-2.5 rounded-xl flex items-center gap-3 text-slate-700 shadow-sm border border-white/50">
                      <Timer size={20} className="text-indigo-400" />
                      <div className="flex flex-col">
                        <span className="text-[10px] font-bold text-slate-400 uppercase tracking-wider leading-none mb-1">
                          Thời gian
                        </span>
                        <span className="font-mono text-2xl font-bold leading-none">
                          {formatTime(time)}
                        </span>
                      </div>
                    </div>
                    <div className="glass-panel px-4 py-2.5 rounded-xl flex items-center gap-3 text-red-600 shadow-sm border border-white/50">
                      <Thermometer size={20} className="text-red-400" />
                      <div className="flex flex-col">
                        <span className="text-[10px] font-bold text-red-300 uppercase tracking-wider leading-none mb-1">
                          Nhiệt độ
                        </span>
                        <span className="font-mono text-2xl font-bold leading-none">
                          {temp.toFixed(1)}°C
                        </span>
                      </div>
                    </div>
                  </div>

                  <div className="flex-1 bg-[url('https://www.transparenttextures.com/patterns/graphy.png')] bg-slate-50 relative flex items-center justify-center overflow-hidden">
                    <div className="absolute inset-0 bg-gradient-to-b from-slate-50 to-slate-100 opacity-80 pointer-events-none"></div>

                    <svg
                      width="100%"
                      height="100%"
                      viewBox="0 0 400 500"
                      preserveAspectRatio="xMidYMid meet"
                      className="drop-shadow-2xl relative z-0 transition-transform duration-500"
                    >
                      <defs>
                        <linearGradient
                          id="waterGrad"
                          x1="0"
                          y1="0"
                          x2="0"
                          y2="1"
                        >
                          <stop
                            offset="0"
                            stopColor="#60a5fa"
                            stopOpacity="0.4"
                          />
                          <stop
                            offset="1"
                            stopColor="#2563eb"
                            stopOpacity="0.7"
                          />
                        </linearGradient>
                        <linearGradient
                          id="glassGrad"
                          x1="0"
                          y1="0"
                          x2="1"
                          y2="1"
                        >
                          <stop offset="0" stopColor="#fff" stopOpacity="0.4" />
                          <stop
                            offset="0.5"
                            stopColor="#fff"
                            stopOpacity="0.1"
                          />
                          <stop offset="1" stopColor="#fff" stopOpacity="0.2" />
                        </linearGradient>
                        <linearGradient
                          id="metalGrad"
                          x1="0"
                          y1="0"
                          x2="1"
                          y2="0"
                        >
                          <stop offset="0" stopColor="#94a3b8" />
                          <stop offset="0.5" stopColor="#f1f5f9" />
                          <stop offset="1" stopColor="#94a3b8" />
                        </linearGradient>
                        <filter id="blur">
                          <feGaussianBlur stdDeviation="2" />
                        </filter>
                        <filter id="dropShadow">
                          <feDropShadow
                            dx="0"
                            dy="4"
                            stdDeviation="4"
                            floodColor="#000"
                            floodOpacity="0.15"
                          />
                        </filter>
                        <marker
                          id="arrowhead"
                          markerWidth="10"
                          markerHeight="7"
                          refX="9"
                          refY="3.5"
                          orient="auto"
                        >
                          <polygon points="0 0, 10 3.5, 0 7" fill="#64748b" />
                        </marker>
                      </defs>

                      <g transform="translate(200, 250) scale(0.95)">
                        {/* Scale Base */}
                        <g transform="translate(-150, 140)">
                          <rect
                            x="0"
                            y="0"
                            width="300"
                            height="10"
                            fill="#334155"
                            rx="2"
                          />
                          <path
                            d="M 20 10 L 20 60 Q 20 70 30 70 L 270 70 Q 280 70 280 60 L 280 10 Z"
                            fill="url(#metalGrad)"
                            filter="url(#dropShadow)"
                          />
                          <rect
                            x="70"
                            y="25"
                            width="160"
                            height="30"
                            rx="2"
                            fill="#0f172a"
                            stroke="#334155"
                          />
                          <text
                            x="220"
                            y="47"
                            fontFamily="monospace"
                            fontSize="20"
                            fill="#22c55e"
                            textAnchor="end"
                            fontWeight="bold"
                          >
                            {(mass * 1000).toFixed(2)} g
                          </text>
                          <circle
                            cx="40"
                            cy="40"
                            r="6"
                            fill="#ef4444"
                            stroke="#b91c1c"
                          />
                          <circle
                            cx="260"
                            cy="40"
                            r="6"
                            fill="#3b82f6"
                            stroke="#1d4ed8"
                          />
                        </g>

                        {/* Flask & Contents - On Scale */}
                        <g transform="translate(0, 135)">
                          <ellipse
                            cx="0"
                            cy="0"
                            rx="40"
                            ry="6"
                            fill="#d7ccc8"
                            stroke="#8d6e63"
                          />
                          <g transform="translate(0, -95)">
                            <path
                              d="M -25 -220 L -25 -100 C -90 -80 -100 0 -100 0 C -100 70 -50 100 0 100 C 50 100 100 70 100 0 C 100 0 90 -80 25 -100 L 25 -220"
                              fill="url(#glassGrad)"
                              opacity="0.3"
                            />
                            <clipPath id="flaskClip">
                              <path d="M -23 -220 L -23 -100 C -88 -80 -98 0 -98 0 C -98 68 -48 98 0 98 C 48 98 98 68 98 0 C 98 0 88 -80 23 -100 L 23 -220 Z" />
                            </clipPath>
                            <g clipPath="url(#flaskClip)">
                              <rect
                                x="-100"
                                y={
                                  100 -
                                  180 *
                                    ((mass /
                                      (config.initialMass / 1000 || 0.2)) *
                                      0.9)
                                }
                                width="200"
                                height="200"
                                fill="url(#waterGrad)"
                                className="transition-all duration-300 ease-linear"
                              />
                              <ellipse
                                cx="0"
                                cy={
                                  100 -
                                  180 *
                                    ((mass /
                                      (config.initialMass / 1000 || 0.2)) *
                                      0.9)
                                }
                                rx="85"
                                ry="10"
                                fill="#93c5fd"
                                opacity="0.5"
                                className="transition-all duration-300 ease-linear"
                              />
                              {temp >= 100 && isRunning && (
                                <g>
                                  {[...Array(6)].map((_, i) => (
                                    <circle
                                      key={i}
                                      cx={Math.random() * 100 - 50}
                                      cy={80}
                                      r={3 + Math.random() * 3}
                                      fill="white"
                                      opacity="0.6"
                                    >
                                      <animate
                                        attributeName="cy"
                                        from="80"
                                        to="-100"
                                        dur={`${0.8 + Math.random()}s`}
                                        repeatCount="indefinite"
                                        begin={`${Math.random()}s`}
                                      />
                                      <animate
                                        attributeName="opacity"
                                        values="0.6;0"
                                        dur={`${0.8 + Math.random()}s`}
                                        repeatCount="indefinite"
                                        begin={`${Math.random()}s`}
                                      />
                                    </circle>
                                  ))}
                                </g>
                              )}
                            </g>
                            <g>
                              <path
                                d="M -15 -240 L -15 0"
                                stroke="#334155"
                                strokeWidth="3"
                              />
                              <path
                                d="M 15 -240 L 15 0"
                                stroke="#334155"
                                strokeWidth="3"
                              />
                              <path
                                d="M -15 0 Q -25 10 -15 20 T -15 40 T -15 60 T -15 80 L 15 80 Q 25 70 15 60 T 15 40 T 15 20 T 15 0"
                                fill="none"
                                stroke={isRunning ? "#ef4444" : "#475569"}
                                strokeWidth="4"
                                className="transition-colors duration-500"
                                filter={isRunning ? "url(#blur)" : ""}
                              />
                              <path
                                d="M -15 0 Q -25 10 -15 20 T -15 40 T -15 60 T -15 80 L 15 80 Q 25 70 15 60 T 15 40 T 15 20 T 15 0"
                                fill="none"
                                stroke={isRunning ? "#fca5a5" : "#64748b"}
                                strokeWidth="2"
                                className="transition-colors duration-500"
                              />
                            </g>
                            <path
                              d="M -25 -220 L -25 -100 C -90 -80 -100 0 -100 0 C -100 70 -50 100 0 100 C 50 100 100 70 100 0 C 100 0 90 -80 25 -100 L 25 -220"
                              stroke="#cbd5e1"
                              strokeWidth="1"
                              fill="none"
                            />
                            <path
                              d="M -90 -20 Q -60 -60 -25 -100"
                              stroke="white"
                              strokeWidth="2"
                              opacity="0.4"
                              filter="url(#blur)"
                              fill="none"
                            />
                            <ellipse
                              cx="0"
                              cy="-220"
                              rx="25"
                              ry="4"
                              fill="#e2e8f0"
                              stroke="#cbd5e1"
                            />
                            {temp >= 100 && isRunning && (
                              <g transform="translate(0, -240)" opacity="0.5">
                                <path
                                  d="M -5 0 Q 5 -20 -5 -40 T -5 -80"
                                  fill="none"
                                  stroke="white"
                                  strokeWidth="4"
                                  filter="url(#blur)"
                                >
                                  <animate
                                    attributeName="d"
                                    values="M -5 0 Q 5 -20 -5 -40 T -5 -80; M 5 0 Q -5 -20 5 -40 T 5 -80; M -5 0 Q 5 -20 -5 -40 T -5 -80"
                                    dur="3s"
                                    repeatCount="indefinite"
                                  />
                                </path>
                              </g>
                            )}
                          </g>
                        </g>

                        {/* Thermometer Group - Corrected Position */}
                        <g transform="translate(140, 0)">
                          <g>
                            <rect
                              x="-4"
                              y="-120"
                              width="8"
                              height="260"
                              rx="4"
                              fill="#f8fafc"
                              stroke="#94a3b8"
                              strokeWidth="1"
                              filter="url(#dropShadow)"
                            />
                            <ellipse
                              cx="0"
                              cy="140"
                              rx="12"
                              ry="4"
                              fill="#94a3b8"
                            />
                            <circle
                              cx="0"
                              cy="125"
                              r="10"
                              fill="#ef4444"
                              stroke="#94a3b8"
                              strokeWidth="1"
                            />
                            <line
                              x1="0"
                              y1="120"
                              x2="0"
                              y2={120 - 220 * (temp / 120)}
                              stroke="#ef4444"
                              strokeWidth="4"
                              strokeLinecap="round"
                            />
                            <g stroke="#64748b" strokeWidth="1">
                              {[
                                0, 20, 40, 60, 80, 100, 120, 140, 160, 180, 200,
                              ].map((val, i) => (
                                <line
                                  key={i}
                                  x1="-4"
                                  y1={120 - 220 * (val / 120)}
                                  x2="0"
                                  y2={120 - 220 * (val / 120)}
                                />
                              ))}
                            </g>
                          </g>
                          <g transform="translate(-15, 80)">
                            <path
                              d="M 0 0 Q -30 0 -50 0"
                              stroke="#64748b"
                              strokeWidth="2"
                              fill="none"
                              markerEnd="url(#arrowhead)"
                            />
                            <text
                              x="-5"
                              y="-10"
                              fontSize="10"
                              fill="#64748b"
                              textAnchor="end"
                              fontWeight="500"
                            >
                              Nhiệt độ nước
                            </text>
                          </g>
                        </g>
                      </g>
                    </svg>
                  </div>
                </div>
              </div>

              {/* RIGHT: Data (Order 3) */}
              <div className="order-3 col-span-12 lg:col-span-3 flex flex-col gap-4 lg:h-full lg:overflow-y-auto custom-scrollbar pb-2">
                {/* Data Table */}
                <div className="bg-white rounded-xl border border-slate-200 shadow-sm flex-1 flex flex-col overflow-hidden hover:shadow-md transition-shadow min-h-[300px]">
                  <div className="bg-slate-50/80 px-5 py-3 border-b border-slate-200 flex justify-between items-center">
                    <h3 className="text-xs font-bold text-slate-700 uppercase tracking-wide flex items-center gap-2">
                      <Calculator size={14} className="text-slate-400" /> Nhật
                      ký
                    </h3>
                    <span className="text-xs bg-indigo-100 text-indigo-700 px-2 py-0.5 rounded font-bold">
                      {selectedPoints.length}/2
                    </span>
                  </div>
                  <div className="flex-1 flex flex-col min-h-0 bg-white">
                    <div className="grid grid-cols-4 bg-slate-50 text-xs font-bold text-slate-500 uppercase py-2.5 px-2 border-b border-slate-100">
                      <div className="text-center">Chọn</div>
                      <div className="text-right pr-4">t(s)</div>
                      <div className="text-right pr-4">T(°C)</div>
                      <div className="text-right pr-2">m(g)</div>
                    </div>
                    <div className="overflow-y-auto custom-scrollbar flex-1">
                      {dataPoints.length === 0 ? (
                        <div className="h-full flex flex-col items-center justify-center text-slate-300 space-y-2 p-6 text-center opacity-80">
                          <Save size={24} strokeWidth={1.5} />
                          <p className="text-xs">Chưa có dữ liệu</p>
                        </div>
                      ) : (
                        <table className="w-full text-sm">
                          <tbody>
                            {dataPoints.map((p, idx) => (
                              <tr
                                key={p.id}
                                onClick={() => toggleSelection(p.id)}
                                className={`cursor-pointer border-b border-slate-50 transition-colors ${
                                  selectedPoints.includes(p.id)
                                    ? "bg-indigo-50 hover:bg-indigo-100 text-indigo-700 font-medium"
                                    : idx % 2 === 0
                                    ? "bg-white hover:bg-slate-50"
                                    : "bg-slate-50/30 hover:bg-slate-50"
                                }`}
                              >
                                <td className="py-3 text-center w-[20%]">
                                  <div
                                    className={`w-4 h-4 rounded border mx-auto flex items-center justify-center transition-all ${
                                      selectedPoints.includes(p.id)
                                        ? "bg-indigo-600 border-indigo-600"
                                        : "border-slate-300 bg-white"
                                    }`}
                                  >
                                    {selectedPoints.includes(p.id) && (
                                      <div className="w-1.5 h-1.5 bg-white rounded-full"></div>
                                    )}
                                  </div>
                                </td>
                                <td className="py-3 text-right pr-6 font-mono text-slate-600">
                                  {p.time}
                                </td>
                                <td className="py-3 text-right pr-6 font-mono text-red-600">
                                  {p.temp}
                                </td>
                                <td className="py-3 text-right pr-4 font-mono text-blue-600">
                                  {p.mass}
                                </td>
                              </tr>
                            ))}
                          </tbody>
                        </table>
                      )}
                    </div>
                  </div>
                  <div className="p-4 border-t border-slate-100 bg-slate-50/50">
                    <button
                      onClick={calculateResults}
                      disabled={selectedPoints.length !== 2}
                      className="w-full py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-slate-200 disabled:text-slate-400 text-white rounded-lg text-xs font-bold uppercase tracking-wide shadow-sm transition-all flex items-center justify-center gap-2 active:scale-[0.98]"
                    >
                      Tính kết quả
                    </button>
                  </div>
                </div>

                {/* Results Card */}
                <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden shrink-0 min-h-[160px] hover:shadow-md transition-shadow">
                  <div className="bg-slate-50/80 px-5 py-3 border-b border-slate-200">
                    <h3 className="text-sm font-bold text-slate-700 uppercase tracking-wide">
                      Kết quả
                    </h3>
                  </div>
                  <div className="p-5">
                    {calculationResult ? (
                      <div className="space-y-4 animate-fade-in-up">
                        <div className="flex justify-between items-baseline border-b border-slate-100 pb-3">
                          <span className="text-sm font-bold text-slate-500 uppercase">
                            Nhiệt hóa hơi{" "}
                            <span className="font-serif font-bold italic normal-case">
                              L
                            </span>
                          </span>
                          <span className="text-2xl font-bold text-indigo-700 font-mono">
                            {Math.round(calculationResult.L).toLocaleString()}{" "}
                            <span className="text-sm text-slate-500 font-sans font-normal">
                              J/kg
                            </span>
                          </span>
                        </div>
                        <div className="bg-slate-50 rounded-lg p-3 border border-slate-100">
                          <div className="text-xs text-slate-400 mb-1 font-mono uppercase tracking-wider">
                            Công thức
                          </div>
                          <div className="text-sm font-mono text-slate-600 break-all leading-relaxed">
                            L = (P · Δt) / Δm <br />= (
                            {calculationResult.p_used} ·{" "}
                            {calculationResult.deltaT.toFixed(1)}) /{" "}
                            {(calculationResult.deltaM_g / 1000).toFixed(4)}
                          </div>
                        </div>
                        <div className="flex items-center justify-between text-sm pt-1">
                          <span className="text-slate-500 font-medium">
                            Sai số:
                          </span>
                          <span
                            className={`font-bold px-2 py-1 rounded-md ${
                              Math.abs(
                                (calculationResult.L - LATENT_HEAT_THEORY) /
                                  LATENT_HEAT_THEORY
                              ) > 0.1
                                ? "bg-red-100 text-red-700"
                                : "bg-emerald-100 text-emerald-700"
                            }`}
                          >
                            {(
                              Math.abs(
                                (calculationResult.L - LATENT_HEAT_THEORY) /
                                  LATENT_HEAT_THEORY
                              ) * 100
                            ).toFixed(2)}
                            %
                          </span>
                        </div>
                      </div>
                    ) : (
                      <div className="h-full flex flex-col items-center justify-center text-slate-300 text-xs text-center py-4">
                        <div className="bg-slate-50 p-3 rounded-full mb-3">
                          <Flame size={24} />
                        </div>
                        <p className="text-sm">Chọn 2 dòng để tính</p>
                      </div>
                    )}
                  </div>
                </div>
              </div>
            </main>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<HeatVaporizationLab />);
    </script>
  </body>
</html>
