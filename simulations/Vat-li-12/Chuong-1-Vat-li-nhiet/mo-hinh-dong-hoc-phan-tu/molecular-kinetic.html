<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>DePhys - Mô hình động học phân tử</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        background-color: #020617;
        color: white;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        overflow: hidden;
      }
      canvas {
        background: #000000;
        border-radius: 12px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        touch-action: none;
      }
      .control-panel {
        background: #0f172a;
        border-top: 1px solid #1e293b;
        z-index: 20;
      }
      input[type="range"] {
        accent-color: #3b82f6;
      }
    </style>
  </head>
  <body class="h-screen w-screen flex flex-col">
    <!-- Header -->
    <header
      class="flex-none w-full px-4 py-3 bg-slate-950 border-b border-slate-800 z-10 flex justify-between items-center shadow-md"
    >
      <div class="text-left">
        <h1 class="text-lg md:text-2xl font-bold text-blue-500">DePhys</h1>
        <p
          class="text-[10px] text-slate-500 hidden sm:block uppercase tracking-widest"
        >
          Mô hình động học phân tử
        </p>
      </div>
    </header>

    <!-- Main Content Area -->
    <main
      class="flex-1 w-full relative flex items-center justify-center p-2 md:p-4 overflow-hidden bg-slate-900/20"
    >
      <!-- Canvas -->
      <canvas
        id="simCanvas"
        class="w-full h-full max-w-6xl border border-slate-800 shadow-inner"
      ></canvas>
    </main>

    <!-- Controls -->
    <footer
      class="control-panel flex-none w-full p-4 md:p-6 flex flex-col gap-4 shadow-2xl"
    >
      <div class="flex justify-center gap-2 md:gap-4">
        <button
          onclick="setMode('solid')"
          id="btn-solid"
          class="px-6 py-2.5 bg-slate-800 hover:bg-blue-600 rounded-xl transition font-bold border border-slate-700 shadow-lg active:scale-95 text-xs md:text-sm uppercase tracking-wider text-slate-300"
        >
          Rắn
        </button>
        <button
          onclick="setMode('liquid')"
          id="btn-liquid"
          class="px-6 py-2.5 bg-slate-800 hover:bg-blue-600 rounded-xl transition font-bold border border-slate-700 shadow-lg active:scale-95 text-xs md:text-sm uppercase tracking-wider text-slate-300"
        >
          Lỏng
        </button>
        <button
          onclick="setMode('gas')"
          id="btn-gas"
          class="px-6 py-2.5 bg-slate-800 hover:bg-blue-600 rounded-xl transition font-bold border border-slate-700 shadow-lg active:scale-95 text-xs md:text-sm uppercase tracking-wider text-slate-300"
        >
          Khí
        </button>
      </div>

      <div
        class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-4 max-w-5xl mx-auto w-full px-4"
      >
        <div class="flex flex-col gap-1">
          <div
            class="flex justify-between text-[10px] font-bold text-slate-500 uppercase"
          >
            <span>Nhiệt độ (Kinetic Energy)</span>
            <span id="tempValue" class="text-blue-400 font-mono">250 K</span>
          </div>
          <input
            type="range"
            id="tempSlider"
            min="0"
            max="20"
            value="5"
            class="w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer"
          />
        </div>

        <div class="flex flex-col gap-1">
          <div
            class="flex justify-between text-[10px] font-bold text-slate-500 uppercase"
          >
            <span>Mật độ hạt (Density)</span>
            <span id="countValue" class="text-blue-400 font-mono">200</span>
          </div>
          <input
            type="range"
            id="countSlider"
            min="50"
            max="400"
            step="50"
            value="200"
            class="w-full h-1.5 bg-slate-800 rounded-lg appearance-none cursor-pointer"
          />
        </div>
      </div>
    </footer>

    <script>
      const canvas = document.getElementById("simCanvas");
      const ctx = canvas.getContext("2d");

      // --- PHYSICS ENGINE ---
      let width, height;
      let particles = [];
      let mode = "gas";
      const PARTICLE_RADIUS = 6;
      let TEMPERATURE = 5;
      let mouse = { x: null, y: null, isDown: false };

      class Particle {
        constructor(x, y) {
          this.x = x;
          this.y = y;
          this.vx = (Math.random() - 0.5) * TEMPERATURE;
          this.vy = (Math.random() - 0.5) * TEMPERATURE;
          this.radius = PARTICLE_RADIUS;
          this.isHighlighted = false;
          this.originalX = x;
          this.originalY = y;
        }

        update() {
          this.isHighlighted = false;

          if (mouse.isDown) {
            const dx = this.x - mouse.x;
            const dy = this.y - mouse.y;
            const dist = Math.sqrt(dx * dx + dy * dy);
            if (dist < 100) {
              this.isHighlighted = true;
              const forceDirectionX = dx / dist;
              const forceDirectionY = dy / dist;
              const force = (100 - dist) / 100;
              this.vx += forceDirectionX * force * 1.5;
              this.vy += forceDirectionY * force * 1.5;
            }
          }

          if (mode === "solid") {
            const k = 0.05;
            this.vx += (this.originalX - this.x) * k;
            this.vy += (this.originalY - this.y) * k;
            this.vx *= 0.9;
            this.vy *= 0.9;
            this.vx += (Math.random() - 0.5) * (TEMPERATURE * 0.1);
            this.vy += (Math.random() - 0.5) * (TEMPERATURE * 0.1);
          } else if (mode === "liquid") {
            this.vx *= 0.99;
            this.vy *= 0.99;
            const currentSpeed = Math.sqrt(
              this.vx * this.vx + this.vy * this.vy
            );
            if (currentSpeed < TEMPERATURE * 0.5) {
              this.vx += (Math.random() - 0.5) * 0.5;
              this.vy += (Math.random() - 0.5) * 0.5;
            }
          }

          this.x += this.vx;
          this.y += this.vy;

          if (this.x - this.radius < 0) {
            this.x = this.radius;
            this.vx *= -1;
          } else if (this.x + this.radius > width) {
            this.x = width - this.radius;
            this.vx *= -1;
          }
          if (this.y - this.radius < 0) {
            this.y = this.radius;
            this.vy *= -1;
          } else if (this.y + this.radius > height) {
            this.y = height - this.radius;
            this.vy *= -0.5;
            if (mode === "gas") this.vy *= 2;
          }
        }

        draw() {
          ctx.beginPath();
          ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
          const speed = Math.sqrt(this.vx * this.vx + this.vy * this.vy);
          const colorOffset = Math.min(speed * 10, 80);

          if (this.isHighlighted) {
            ctx.fillStyle = "#ffffff";
            ctx.shadowBlur = 15;
            ctx.shadowColor = "#3b82f6";
          } else {
            ctx.fillStyle =
              mode === "solid"
                ? `hsl(${210 - colorOffset}, 70%, 50%)`
                : `hsl(${220 - colorOffset}, 80%, ${40 + colorOffset / 4}%)`;
            ctx.shadowBlur = 0;
          }
          ctx.fill();
          ctx.closePath();

          if (mode === "solid" && !this.isHighlighted) {
            ctx.strokeStyle = "rgba(255,255,255,0.05)";
            ctx.beginPath();
            ctx.moveTo(this.x, this.y);
            ctx.lineTo(this.originalX, this.originalY);
            ctx.stroke();
          }
        }
      }

      function init() {
        resize();
        createParticles();
        animate();
        updateButtonStyles();
      }

      function resize() {
        width = canvas.width = canvas.clientWidth;
        height = canvas.height = canvas.clientHeight;
      }

      function createParticles() {
        particles = [];
        const count = parseInt(document.getElementById("countSlider").value);

        if (mode === "solid") {
          const cols = Math.floor(Math.sqrt((count * width) / height));
          const rows = Math.ceil(count / cols);
          const spacingX = width / (cols + 1);
          const spacingY = (height / (rows + 1)) * 0.8;
          let i = 0;
          for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
              if (i >= count) break;
              particles.push(
                new Particle(
                  (c + 1) * spacingX,
                  height - (rows - r) * spacingY - 50
                )
              );
              i++;
            }
          }
        } else if (mode === "liquid") {
          for (let i = 0; i < count; i++) {
            particles.push(
              new Particle(
                Math.random() * (width - 20) + 10,
                height - Math.random() * (height / 2) - 20
              )
            );
          }
        } else {
          for (let i = 0; i < count; i++) {
            const p = new Particle(
              Math.random() * (width - 20) + 10,
              Math.random() * (height - 20) + 10
            );
            p.vx = (Math.random() - 0.5) * 10;
            p.vy = (Math.random() - 0.5) * 10;
            particles.push(p);
          }
        }
      }

      function handleParticleCollisions() {
        for (let i = 0; i < particles.length; i++) {
          for (let j = i + 1; j < particles.length; j++) {
            const p1 = particles[i];
            const p2 = particles[j];
            const dx = p2.x - p1.x;
            const dy = p2.y - p1.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            const minDistance = p1.radius + p2.radius;

            if (distance < minDistance) {
              const angle = Math.atan2(dy, dx);
              const targetX = p1.x + Math.cos(angle) * minDistance;
              const targetY = p1.y + Math.sin(angle) * minDistance;
              const ax = (targetX - p2.x) * 0.05;
              const ay = (targetY - p2.y) * 0.05;
              p1.vx -= ax;
              p1.vy -= ay;
              p2.vx += ax;
              p2.vy += ay;

              if (mode !== "solid") {
                const tempVx = p1.vx;
                const tempVy = p1.vy;
                const res = mode === "gas" ? 1.0 : 0.8;
                p1.vx = p2.vx * res;
                p1.vy = p2.vy * res;
                p2.vx = tempVx * res;
                p2.vy = tempVy * res;
              }
            }
          }
        }
      }

      function animate() {
        ctx.clearRect(0, 0, width, height);
        TEMPERATURE = parseInt(document.getElementById("tempSlider").value);
        handleParticleCollisions();
        particles.forEach((p) => {
          p.update();
          p.draw();
        });
        requestAnimationFrame(animate);
      }

      window.setMode = function (newMode) {
        mode = newMode;
        updateButtonStyles();
        createParticles();
      };

      function updateButtonStyles() {
        ["solid", "liquid", "gas"].forEach((m) => {
          const btn = document.getElementById(`btn-${m}`);
          if (m === mode) {
            btn.classList.add(
              "bg-blue-600",
              "text-white",
              "border-blue-400",
              "shadow-blue-900/40"
            );
            btn.classList.remove("bg-slate-800", "text-slate-300");
          } else {
            btn.classList.remove(
              "bg-blue-600",
              "text-white",
              "border-blue-400",
              "shadow-blue-900/40"
            );
            btn.classList.add("bg-slate-800", "text-slate-300");
          }
        });

        const tempSlider = document.getElementById("tempSlider");
        if (mode === "solid") tempSlider.value = 2;
        else if (mode === "liquid") tempSlider.value = 8;
        else tempSlider.value = 15;

        document.getElementById("tempValue").innerText =
          tempSlider.value * 50 + " K";
        TEMPERATURE = parseInt(tempSlider.value);
      }

      window.addEventListener("resize", () => {
        resize();
        createParticles();
      });
      document.getElementById("tempSlider").addEventListener("input", (e) => {
        document.getElementById("tempValue").innerText =
          e.target.value * 50 + " K";
        TEMPERATURE = parseInt(e.target.value);
      });
      document.getElementById("countSlider").addEventListener("input", (e) => {
        document.getElementById("countValue").innerText = e.target.value;
        createParticles();
      });

      const updateMouse = (e) => {
        const rect = canvas.getBoundingClientRect();
        mouse.x =
          (e.clientX || (e.touches && e.touches[0].clientX)) - rect.left;
        mouse.y = (e.clientY || (e.touches && e.touches[0].clientY)) - rect.top;
      };

      canvas.addEventListener("mousedown", (e) => {
        mouse.isDown = true;
        updateMouse(e);
      });
      canvas.addEventListener("mousemove", (e) => {
        if (mouse.isDown) updateMouse(e);
      });
      window.addEventListener("mouseup", () => (mouse.isDown = false));
      canvas.addEventListener(
        "touchstart",
        (e) => {
          mouse.isDown = true;
          updateMouse(e);
        },
        { passive: false }
      );
      canvas.addEventListener(
        "touchmove",
        (e) => {
          if (mouse.isDown) {
            updateMouse(e);
            e.preventDefault();
          }
        },
        { passive: false }
      );
      window.addEventListener("touchend", () => (mouse.isDown = false));

      window.onload = init;
    </script>

    <!-- Elfsight AI Chatbot | Untitled AI Chatbot -->
    <script src="https://elfsightcdn.com/platform.js" async></script>
    <div
      class="elfsight-app-131656ee-bb10-4a92-a766-86c412c36d15"
      data-elfsight-app-lazy
    ></div>
  </body>
</html>
